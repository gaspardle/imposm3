package main

import "github.com/gaspardle/go-mssqlclrgeo"
import (
	"encoding/hex"
	"fmt"
	_ "log"
)

func main() {
	readUdtGeography()
	convertWkbToGeoUdt()
}

func readUdtGeography() {

	sample_geo, _ := hex.DecodeString("110F0000010425000000BFD4D2126E6C5FC126C3F03633B75541FF24203F1B6A5FC1BD1254075EB855412EAC55178E675FC1DB5230D4ADBB5541E40FBAC41A675FC1740EA1D518BE55413F934D46D1615FC180B2E7CBE6C255416CDE8805BE5D5FC189497D5D19C25541A100F95F875C5FC1CB663183A9C0554149C48659665B5FC1D9F6516CE2C155414B5319A8A0535FC1A2641DB5AAC05541B33EC0BB0B515FC1F5CDE59314C25541FC66B37557505FC1E138AF2C5EC355416ED2341A6F495FC1F3A1053C90C75541BFDB3CA39F445FC13E281E3A9DD2554183236D5EE9415FC16E52E67E77D555418E1BA819D9395FC15E6B0AC15ADB5541BCB730BFC5385FC1D35E0BB5EFDD5541C3B27C1D7F335FC10A35E207BDDE55415E36D6B8EC345FC194487EF99DD95541D131B34DC9335FC1AC12F1BD87D5554122F5B99331365FC1DED03E0885D05541A6AD731A41365FC15760D47593CA5541067FE6EC63395FC199787FFB57C45541C039D2B639385FC1571C999D82BE554177D15CB2F1385FC1758486C4A8BC5541F748687E4B385FC1403349ECE8B65541229482E3FF385FC14E5B89E853B45541097D1080463A5FC11451A573F5B255413FF0C7649F3D5FC1B9AA4AC3AEB155413C5049A01D445FC1FA04470B0AB1554164746E8DD7495FC1CD66ABB1E2B25541699C11A97D4F5FC1B0334C2A94B25541D20D6A35BB545FC1AB4056C689B1554147F19AC967575FC19DACEF7F3EAF5541EFCA7AEE60605FC16ABA2C0D0FB15541D1F05B66A8665FC1A4112E858BAF5541F0DD974EF86A5FC1A16CAB14C1B25541BFD4D2126E6C5FC126C3F03633B7554101000000020000000001000000FFFFFFFF0000000003")

	g, err := mssqlclrgeo.ReadGeometry(sample_geo)
	if err != nil {
		fmt.Println(err)
	}

	showInfo(g)
}

func convertWkbToGeoUdt() {

	wkb, _ := hex.DecodeString("0104000020E610000003000000010100000000000000000008400000000000001440010100000000000000000010400000000000002040010100000000000000000020400000000000001C40")

	fmt.Println("*** Converting wkb to udt geography ***")
	udtbin, err := mssqlclrgeo.WkbToUdtGeo(wkb)
	if err != nil {
		fmt.Println(err)
	}

	g, err := mssqlclrgeo.ReadGeometry(udtbin)
	if err != nil {
		fmt.Println(err)
	}
	showInfo(g)

	fmt.Printf("Result: %s\n", hex.EncodeToString(udtbin))

}

func showInfo(g *mssqlclrgeo.Geometry) {
	fmt.Printf("SRID: %d\n", g.SRID)
	fmt.Printf("Version %d\n", g.Version)

	fmt.Printf("Properties: H:%t L:%t P:%t V:%t M:%t Z:%t \n", g.Properties.H, g.Properties.L, g.Properties.P, g.Properties.V, g.Properties.M, g.Properties.Z)
	fmt.Printf("Points count:  %d\n", len(g.Points))
	fmt.Printf("Figure count:  %d\n", len(g.Figures))
	for i, figure := range g.Figures {
		fmt.Printf("figure #%d type: %d\n", i, figure.Attribute)
	}
	fmt.Printf("Shape count:  %d\n", len(g.Shapes))
	for i, shape := range g.Shapes {
		fmt.Printf("shape #%d type: %d\n", i, shape.OpenGisType)
	}
	fmt.Printf("Segment count:  %d\n", len(g.Segments))

}
